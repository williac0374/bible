<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KJV Bible Navigator</title>
    <style>
        /* Basic styling for readability and button appearance */
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f4f4f9;
        }
        #container {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        .section-title {
            margin-top: 10px;
            color: #333;
            border-bottom: 2px solid #ccc;
            padding-bottom: 5px;
        }
        .button-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
        }
        button {
            padding: 8px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            background-color: #007bff;
            color: white;
            transition: background-color 0.2s;
        }
        button:hover {
            background-color: #0056b3;
        }
        /* Specific styles for different button groups */
        #booksList button { background-color: #28a745; }
        #booksList button:hover { background-color: #1e7e34; }
        #chaptersList button { background-color: #ffc107; color: #333; }
        #chaptersList button:hover { background-color: #e0a800; }
        #versesList button { background-color: #17a2b8; }
        #versesList button:hover { background-color: #117a8b; }
        #contentDisplay {
            margin-top: 20px;
            padding: 15px;
            border: 1px solid #ccc;
            background-color: #fff;
            border-radius: 5px;
        }
    </style>
</head>
<body>

    <h1>KJV Bible Navigator</h1>
    <p>Select a Book, Chapter, and Verse to read the text.</p>
    
    <div id="container">
        <div id="booksSection">
            <h2 class="section-title">1. Select a Book</h2>
            <div id="booksList" class="button-list">
                </div>
        </div>

        <div id="chaptersSection" style="display:none;">
            <h2 class="section-title">2. Select a Chapter in <span id="currentBookName"></span></h2>
            <div id="chaptersList" class="button-list">
                </div>
        </div>

        <div id="versesSection" style="display:none;">
            <h2 class="section-title">3. Select a Verse from Chapter <span id="currentChapterNumber"></span></h2>
            <div id="versesList" class="button-list">
                </div>
        </div>

        <div id="contentSection" style="display:none;">
            <h2 class="section-title">4. Bible Content: <span id="currentReference"></span></h2>
            <div id="contentDisplay">
                </div>
        </div>
    </div>

    <script>
        // ASSUMPTION: The JSON files are in a directory named 'kjv'
        const KJV_DIR = './kjv/';
        const booksListElement = document.getElementById('booksList');
        const chaptersListElement = document.getElementById('chaptersList');
        const versesListElement = document.getElementById('versesList');
        const contentDisplay = document.getElementById('contentDisplay');
        const booksSection = document.getElementById('booksSection');
        const chaptersSection = document.getElementById('chaptersSection');
        const versesSection = document.getElementById('versesSection');
        const contentSection = document.getElementById('contentSection');
        
        // Cache to store loaded JSON data (to avoid re-fetching)
        const bookDataCache = {};
        
        // --- 1. Load Initial Book List ---
        async function loadBookList() {
            try {
                // Fetch the list of book names (assuming you have a Books.json or similar)
                // A common KJV repo has a JSON file for the whole Bible, but if you're using 
                // the book-per-file format, we need a list of book names.
                // We'll hardcode the full KJV list for simplicity, but a proper JSON list is safer.

                // Using the book list from the common GitHub repo structure (aruljohn/Bible-kjv)
                const response = await fetch(`${KJV_DIR}Books.json`);
                if (!response.ok) {
                    throw new Error("Could not find Books.json in the 'kjv' folder. Please ensure it is present or use the hardcoded list.");
                }
                const bookNames = await response.json();
                
                bookNames.forEach(bookName => {
                    const button = document.createElement('button');
                    button.textContent = bookName;
                    button.onclick = () => displayChapters(bookName);
                    booksListElement.appendChild(button);
                });
                
            } catch (error) {
                console.error("Error loading book list:", error);
                booksListElement.innerHTML = `<p style="color:red;">Error loading KJV Bible data. Check the console for details and ensure all 66 book JSON files (plus Books.json) are in a folder named 'kjv'.</p>`;
                
                // Fallback to a few books if Books.json fails
                const fallbackBooks = ["Genesis", "Psalms", "Matthew", "Revelation"];
                console.warn("Falling back to a small set of hardcoded books.");
                fallbackBooks.forEach(bookName => {
                    const button = document.createElement('button');
                    button.textContent = bookName + " (Fallback)";
                    button.onclick = () => displayChapters(bookName);
                    booksListElement.appendChild(button);
                });
            }
        }

        // --- 2. Display Chapters for a Selected Book ---
        async function displayChapters(bookName) {
            
            // 1. Hide subsequent sections and clear content
            chaptersListElement.innerHTML = '';
            versesListElement.innerHTML = '';
            contentDisplay.innerHTML = '';
            contentSection.style.display = 'none';
            versesSection.style.display = 'none';
            
            // 2. Update the header
            document.getElementById('currentBookName').textContent = bookName;
            chaptersSection.style.display = 'block';
            
            // 3. Load the specific book data
            if (!bookDataCache[bookName]) {
                try {
                    // Assuming the file name is exactly the Book Name + ".json"
                    const fileName = `${bookName}.json`;
                    const response = await fetch(`${KJV_DIR}${fileName}`);
                    if (!response.ok) {
                        chaptersListElement.innerHTML = `<p style="color:red;">Error: Could not find **${fileName}** in the 'kjv' folder.</p>`;
                        return;
                    }
                    bookDataCache[bookName] = await response.json();
                } catch (error) {
                    console.error(`Error fetching ${bookName} data:`, error);
                    chaptersListElement.innerHTML = `<p style="color:red;">A network error occurred while fetching ${bookName}.json.</p>`;
                    return;
                }
            }
            
            const bookData = bookDataCache[bookName];
            const chapters = bookData.chapters;

            // 4. Create a button for every chapter
            chapters.forEach(chapter => {
                const chapterNumber = chapter.chapter;
                const button = document.createElement('button');
                button.textContent = chapterNumber;
                button.onclick = () => displayVerses(bookName, chapterNumber, chapter.verses);
                chaptersListElement.appendChild(button);
            });
        }

        // --- 3. Display Verses for a Selected Chapter ---
        function displayVerses(bookName, chapterNumber, verses) {
            
            // 1. Hide subsequent sections and clear content
            versesListElement.innerHTML = '';
            contentDisplay.innerHTML = '';
            contentSection.style.display = 'none';

            // 2. Update the header
            document.getElementById('currentChapterNumber').textContent = chapterNumber;
            versesSection.style.display = 'block';
            
            // 3. Create a button for every verse
            verses.forEach(verse => {
                const verseNumber = verse.verse;
                const verseText = verse.text;
                
                const button = document.createElement('button');
                button.textContent = verseNumber;
                
                // When clicked, display the final content
                button.onclick = () => displayContent(bookName, chapterNumber, verseNumber, verseText);
                versesListElement.appendChild(button);
            });
        }

        // --- 4. Display Final Verse Content ---
        function displayContent(bookName, chapterNumber, verseNumber, verseText) {
            
            // 1. Update the header
            const reference = `${bookName} ${chapterNumber}:${verseNumber}`;
            document.getElementById('currentReference').textContent = reference;
            contentSection.style.display = 'block';

            // 2. Display the verse text
            contentDisplay.innerHTML = `
                <p><strong>${reference}</strong></p>
                <p>${verseText}</p>
            `;
            
            // Optionally scroll to the content
            contentSection.scrollIntoView({ behavior: 'smooth' });
        }

        // Initialize the app by loading the book buttons
        loadBookList();
    </script>

</body>
</html>
